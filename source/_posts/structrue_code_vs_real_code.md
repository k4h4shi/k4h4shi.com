---
title: 構造コード vs リアルコード
date: 2017/06/01 22:10:05
---

この記事は[k4h4shi's blog](http://k4h4shi.hatenablog.com/entry/2017/06/01/221005)からの移転記事です

## はじめに

[ZERO BUGS](https://www.amazon.co.jp/ZERO-BUGS-%E3%82%B7%E3%83%AA%E3%82%B3%E3%83%B3%E3%83%90%E3%83%AC%E3%83%BC%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%81%AE%E6%95%99%E3%81%88-%E3%82%B1%E3%82%A4%E3%83%88-%E3%83%88%E3%83%B3%E3%83%97%E3%82%BD%E3%83%B3/dp/4822255131/ref=sr_1_1?s=books&ie=UTF8&qid=1496318866&sr=1-1)を購入して読んでみたところ、構造 vs リアルコードという章があり興味深かったので抜粋して少し考えてみる。

## 2種類のコード

この章の中で著者はコードを構造コードとリアルコードの二つに分類している。

自分が書いているコードがどちらに当たるのかを考えてみることで、本来の目的を見失わずに済むかもしれない。

## 構造コードとは
構造コードとは、ものをつなぎ合わせるためのコード。

処理を共通化を行うコードや、デザインパターンなどがそれにあたり、繰り返し出現する構造を抽出して柔軟性を高めたい場合などに記述される。

著者は1行の構造コードは2つの異なる場所で必要とされた場合にのみ描かれるべきだと言う。

## リアルコードとは
リアルコードとは、実際に何かを行うコード。

ファイルを開いたり、画面に何かを描画したり、月までの距離を計算したりするのがリアルコード。

構造コードに対比させるならば、1行のリアルコードは目的の達成に必要とされた場合にのみ書かれるべきだと思う。


## 高品質のコードを目指すために
_高品質なコードを目指すためには、構造コードを可能な限り減らすことが必要となる。_

### コードの良さを表す関数gの最適化問題
以下の式ではrはリアルコード、sは構造コード、fは必要とされる柔軟性、そしてtはタスクを完了させるために必要なコードを表す。
```
g(r, s) = r - s
  s >= f
  r == t
```
ここでの目的は、gを最大化させることである。

rに対しsが大きすぎるならば、それだけgも小さくなってしまう。

必要な柔軟性だけを担保し、タスクに対してコードを書いていくと良いことがわかる。

### 構造コードを書くべき時
著者は、後方互換性が必要な局面において3か所以上で参照されることがわかっている場合には、構造コードを書くべきだとしている。

これはKISSやYAGNIにも共通する考え方である。


後々のことを考えて、というのは構造コードを追加する理由にはならないということだ。

> 「初めて何かを行うときは、ただやるのみだ。2回目に何か似たようなことを行うとき重複に気付いてたじろぎ、それでも同ようにやるだろう。似たようなことを行うのが3回目なら、リファクタリングしよう。」

同じコードを3回書いた時、これらを共通化できないか、するならばどんな構造コードが必要かを問いかけるようにすると良いだろう。

## まとめ

無意味な構造コードを書きがちな自分にとっては良い戒めであり、すっと理解できた。

設計や構造をあれこれするよりも、言語のAPIを上手く利用したり、品質の良いライブラリを活用することで、1行のリアルコードが為すタスクを最大にすることを考える必要がある。

著者は2種類に分けるのは教えるのに便利だからであり、どちらのカテゴリにも当てはまらないものがある。だから原理を一度理解したならば、その先へ進んで欲しいと言う。

しばらくは、この2つの分類でコードを考えてみようと思う。

## 参考文献
- [ZERO BUGS](https://www.amazon.co.jp/ZERO-BUGS-%E3%82%B7%E3%83%AA%E3%82%B3%E3%83%B3%E3%83%90%E3%83%AC%E3%83%BC%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%81%AE%E6%95%99%E3%81%88-%E3%82%B1%E3%82%A4%E3%83%88-%E3%83%88%E3%83%B3%E3%83%97%E3%82%BD%E3%83%B3/dp/4822255131/ref=sr_1_1?s=books&ie=UTF8&qid=1496318866&sr=1-1) 
- [Martin Fowler氏によるリファクタリングのワークフロー](https://www.infoq.com/jp/news/2014/03/fowler-workflows-refactoring)

- [何かのときにすっと出したい、プログラミングに関する法則・原則一覧](http://qiita.com/hirokidaichi/items/d6c473d8011bd9330e63)
